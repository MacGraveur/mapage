<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Julien Benedetti">

<title>Nouveaux venus dans le paysage des archives publiques : Monaco et IA – Mac Graveur</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-dcc7d9e706e4adfbab8e3d6c7c60bab2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mac Graveur</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house-door-fill" role="img">
</i> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../veille/index.html"> <i class="bi bi-bookmark" role="img">
</i> 
<span class="menu-text">Veille</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blocnotes/index.html"> <i class="bi bi-journal-richtext" role="img">
</i> 
<span class="menu-text">Bloc-notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../realisation.html"> <i class="bi bi-bricks" role="img">
</i> 
<span class="menu-text">Réalisations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publication.html"> <i class="bi bi-pen-fill" role="img">
</i> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lecture.html"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Mes lectures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> <i class="bi bi-person-bounding-box" role="img">
</i> 
<span class="menu-text">Qui suis-je ?</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#la-création-des-archives-nationales-de-la-principauté-de-monaco-en-2025" id="toc-la-création-des-archives-nationales-de-la-principauté-de-monaco-en-2025" class="nav-link active" data-scroll-target="#la-création-des-archives-nationales-de-la-principauté-de-monaco-en-2025">La création des Archives nationales de la principauté de Monaco en 2025</a></li>
  <li><a href="#lia-au-delà-du-buzz" id="toc-lia-au-delà-du-buzz" class="nav-link" data-scroll-target="#lia-au-delà-du-buzz">L’IA au-delà du buzz</a></li>
  <li><a href="#lia-au-service-des-projets-industriels" id="toc-lia-au-service-des-projets-industriels" class="nav-link" data-scroll-target="#lia-au-service-des-projets-industriels">L’IA au service des projets industriels</a></li>
  <li><a href="#explorer-le-contenu-des-messageries-électroniques-avec-les-llm" id="toc-explorer-le-contenu-des-messageries-électroniques-avec-les-llm" class="nav-link" data-scroll-target="#explorer-le-contenu-des-messageries-électroniques-avec-les-llm">Explorer le contenu des messageries électroniques avec les LLM</a></li>
  <li><a href="#lettres-en-lumières-une-ia-pour-transcrire-automatiquement-les-archives-du-xviiie-siècle" id="toc-lettres-en-lumières-une-ia-pour-transcrire-automatiquement-les-archives-du-xviiie-siècle" class="nav-link" data-scroll-target="#lettres-en-lumières-une-ia-pour-transcrire-automatiquement-les-archives-du-xviiie-siècle">Lettres en Lumières : une IA pour transcrire automatiquement les archives du XVIIIe siècle</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Nouveaux venus dans le paysage des archives publiques : Monaco et IA</h1>
  <div class="quarto-categories">
    <div class="quarto-category">IA</div>
    <div class="quarto-category">archives</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Auteur·rice</div>
    <div class="quarto-title-meta-contents">
             <p>Julien Benedetti </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Date de publication</div>
    <div class="quarto-title-meta-contents">
      <p class="date">6 novembre 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="la-création-des-archives-nationales-de-la-principauté-de-monaco-en-2025" class="level2">
<h2 class="anchored" data-anchor-id="la-création-des-archives-nationales-de-la-principauté-de-monaco-en-2025">La création des Archives nationales de la principauté de Monaco en 2025</h2>
<p><em>Michaël Bloche, Directeur des Archives nationales de la Principauté de Monaco</em></p>
<p>Ce service fait suite à une mission de préfiguration crée en 2021. Celle-ci était précédé par un service des archives princiaires. Le service des archives princiaires est fondée en 1911, il faudra attendre le milieu des années 60 pour voir la mise en place un service des archives du gouvernement. Le mise en oeuvre de ce service de préarchivage bénéficie de l’apport du service technique de la DAF, et notamment d’un rapport de préconisations de Michel Duchein.</p>
<p>L’ordonnance cadrant les missions du service, et les notes indiquants ces moyens sont pris entre 1967 et 1968. Le service est confié à Mme Marguerite Zilliox. Hélas à son départ deux ans plus tard, le service est fermé par absence de personnel. Le dossier de création et de moyens est le sujet de tension politique entre le palais et le conseil national.</p>
<p>La création d’un service central est même l’objet d’article de presse très sévère : “servivce intutile”, “service parasite”…</p>
<p>Le gouvernement de Monaco a envisagé d’engager un archiviste français, et a notamment refusé le profil d’Yves Pérotin, manquant ainsi pour M.Bloque “l’affaire du siècle du point de vue des archives”. Il est envisagé d’envoyer un monegasque en stage auprès des Archives départementales des Bouches-du-Rhône mais M.Villard décline et oriente Monaco vers les Archives des Alpes-Maritimes. Ernest HildesHeimer y interviendra à temps partiel au début des années 70. En s’appuyant sur les recommandations de Duchein, des locaux d’archives conforment aux normes de conservation est construit. Hélas dès le début des années 80 les locaux d’archives sont largement amputés pour faire de la place aux nouveaux services informatiques.</p>
<p>Du milieu des années 80 à au début des années 2000, plusieurs études et projets pour établir dans de nouveaux locaux le service restent lettres mortes.</p>
<p>Il faudrau attendre 2011 pour voir la publication d’une ordonnance fondant la création d’un service central pour la conservation des archives définitives du Gouvernement princie (SCADA)r, ainsi que d’une commission consutative des archives de l’État. Suivra en 2021 la création d’une mission de préfiguration des Archives nationales, qui une tutelle que le SCADA. Ce nouveau service est un basculement car il intégre la notion patrimoniale.</p>
<p>2025 voit l’aboutissement de cette mission avec :</p>
<ul>
<li>de nouveaux locaux,</li>
<li>un site internetv,</li>
<li>une équipe renforcée avec 13 agents.</li>
</ul>
<p>Ce service s’articule avec les autres services d’archives :</p>
<ul>
<li>archives du palais princier,</li>
<li>archives communales,</li>
<li>institutut audiovisuel,</li>
<li>services d’entrés parapubliques et privées.</li>
</ul>
</section>
<section id="lia-au-delà-du-buzz" class="level2">
<h2 class="anchored" data-anchor-id="lia-au-delà-du-buzz">L’IA au-delà du buzz</h2>
<p><em>Georges Rodrigues, Directeur des systèmes d’information Ville d’Avignon</em></p>
<p>Est-ce que l’IA me répond quelque chose de juste ? Probablement. Les IAG répondent sur la base de probabilité statisitque. Sachant que la réponse peut évoluer si on améliore le contexte de la demande.</p>
<p>Les prompts et leur qualité et précision sont donc capitales pour avoir la meilleure réponse possible, même si celle-ci reste toujours probabiliste.</p>
<p>Les IA généraliste peuvent être adaptées par le Fine Tunig (spécialisation de l’IA à un sujet), ou le RAG (réponse basé sur un corpus fermé).</p>
<p>Dans le monde professionnel, 31 % des français sont inquiets contre 15 % dans le monde. Même si on voit déjà quelques entreprises réduires leurs effectif il est impossible de prédire l’impact réel à plusieurs décennies. 55 % des salariés sans en informer ses supérieurs hiérarchiques.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="IMG_2495.jpg" class="img-fluid figure-img"></p>
<figcaption>figure 1</figcaption>
</figure>
</div>
<p>La ville d’Avignon a déjà plusieurs usages de l’IA mais dans le cadre d’une charte.</p>
</section>
<section id="lia-au-service-des-projets-industriels" class="level2">
<h2 class="anchored" data-anchor-id="lia-au-service-des-projets-industriels">L’IA au service des projets industriels</h2>
<p><em>Valérie Kauffmann, EDF DIPDE</em></p>
<p>EDF a mené une expérimentation sur la recherche dans ses plans techniques (2D ou 3D). L’idée est de gagner du temps dans la recherche de la documention, srutout que celle-ci est très vaste. Ceci dans le but de permettre aux ingénieurs d’être plus concentrés sur leurs missions d’ingénieurie. Le projet est encore en expérimentation, il n’y a pas de passage à l’échelle industrielle car cela nécessiterai de déposer les documents sur des clouds américains.</p>
</section>
<section id="explorer-le-contenu-des-messageries-électroniques-avec-les-llm" class="level2">
<h2 class="anchored" data-anchor-id="explorer-le-contenu-des-messageries-électroniques-avec-les-llm">Explorer le contenu des messageries électroniques avec les LLM</h2>
<p><em>Céline Guyon, Olkoa et ENSSIB</em></p>
<p>Il s’agit d’un projet en mode R&amp;D de deploiement d’un RAG pour explorer les boites mails. Ce projet a été mené en collaboration avec l’école la Plateforme, qui forme au numérique et notamment des datascientist.</p>
<p>Plusieurs questions se posent au sujet des messageries : quel niveau de description ? quel est le producteur et sa nature ? quelles DUA appliqués ? quelles éliminations possibles ? problématique de la conformité en fonction des usages professionnels et personnels ? Les messageries posent aussi des défis sur les aspects techniques.</p>
<p>Enfin, il y a un probléme sur l’accès à ces messageries. A ce jour ce qui se fait le plus est de recharger le container pst dans un outil de messagerie.</p>
<p>Une messagerie n’est que rarement l’objet d’une pratique standarisée, mais relève plutôt du choix d’organisation personnelles. C.Guyon souligne l’absence de prise en compte de l’accès au profit de la préservation.</p>
<p>Les messageries ont été identifiées comme étant un bon candidat à une exploration avec une LLM. La messagerie est un artefact archivistique, comment une IA pouvait donner à voir cet artafact, les relations, l’organisation, les échanges. Le but était d’aller plus loin qu’une simple recherche par mot-clefs.</p>
<p>Le projet a été mené via 3 sprint d’un mois avec des alternants de la plateforme. Le projet est documenté sur Github mais n’a pas vocation à devenir un produit ou un outil. Il reste un objet exploratoire.</p>
<p>Plusieurs ambitions : explorer les contenus des mails dans une logique sémantique, intérargir via un chabot pour interroger le contenu.</p>
<p>La première chose qui a été fait, n’est pas un traitement par une IA mais une analyse de réseau représentant les interactions. La coeur du projet se porte sur la recherche sémantique.</p>
<p>Il faut dans un premier temps faire du_clustering_ pour vectoriser les courriels. Se découpage donne des morceaux <em>chunks</em>, ce découpage dépend des modèles utilisés. Ensuite, il faut passer un modèle d’<em>embeddings</em> qui abouti a une vectorisation des morceaux. Le tout crée un espace latent qui positionne donc chaque <em>chunks</em> leur proximité ou éloignement correspond à leur proximité ou éloignement sémantique.</p>
<p>On peut ensuite faire émerger des <em>clusters</em> c’est à dire de thèmes. Il faut trouver un équilibre dans le nombre de <em>clusters</em> généré.</p>
<p>Autre étape mise en place, l’utilisation d’un RAG. Le LLM a été entraîné sur d’autres contenus mais de répond qu’en fonction du corpus fourni. Ce choix permet des traitements en local et donc en protection des données analysées. Grâce à ce RAG un chatbot peut être interrogé qui va répondre en indiquant sur quels mails sont appuyés ses réponses.</p>
<p>Faire de l’archivistique au temps des algorithmes ? L’IA a permis d’intervenir là où la main et l’oeil de l’archiviste ne le pouvait plus. Les traitements en vecteurs n’est pas accessible à l’humain. La médiation computationelle donne à voir la logique de structuration d’un corpus de documents et les relations des documents entre eux.</p>
</section>
<section id="lettres-en-lumières-une-ia-pour-transcrire-automatiquement-les-archives-du-xviiie-siècle" class="level2">
<h2 class="anchored" data-anchor-id="lettres-en-lumières-une-ia-pour-transcrire-automatiquement-les-archives-du-xviiie-siècle">Lettres en Lumières : une IA pour transcrire automatiquement les archives du XVIIIe siècle</h2>
<p><em>Édouard Bouyé, Directeur des Archives de la Côte-d’Or</em></p>
<p>Le projet a été lancé un peu par le fait d’un hasard d’une rencontre avec un chercheur en IA. Ceci a abouti à l’accueil d’un étudiant (dans un premier temps en stage) en thèse pour 3 ans.</p>
<p>Le modèle est entraîné à partir de transcription de bénévoles, puis avec une correction est effectuée par un membre des AD. Il faut savoir accompagner les bénévoles et en prendre soin.</p>
<p>La plate-forme de contribution est basée sur le IIIF. Il est possible d’importer via un manifest IIIF des lots d’images (jusqu’à 5) pour faire le traitement via l’IA.</p>
<p>Les AD de Côte-d’Or sont à la recherche de partenaires pour poursuivre le projet.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/macgraveur\.github\.io\/mapage\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>